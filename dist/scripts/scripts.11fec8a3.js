"use strict";angular.module("angularApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.grid","ui.grid.expandable","ui.grid.selection","ui.grid.autoResize","nvd3","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/grid.html",controller:"GridCtrl",controllerAs:"grid"}).otherwise({redirectTo:"/"})}]),angular.module("angularApp").filter("abs",function(){return function(a){return Math.abs(a)}}),angular.module("angularApp").directive("buildResultSection",function(){var a={};return a.restrict="E",a.template="",a.scope={data:"@"},a.compile=function(a,b){var c=function(a,b,c){var d=JSON.parse(a.data),e=d.result&&d.result.status,f=d.result&&d.result.cta_type,g=d.state_id,h=(d.req_type,d.stateName),i=d.stateInfo.type,j="",k="";switch(g){case 2:case 3:case 5:h="Change "+h}switch(e){case"auto_merged":j="Auto Merged";break;case"metrics_reduction":j="Metrics Reduction";break;default:j=""}switch(f){case 1:k='<div class="result-cta ctatype-'+f+'"><button>Merged Build</button></div>';break;case 2:k='<div class="result-cta ctatype-'+f+'"><button>Find Issues</button></div>';break;case 3:k='<div class="result-cta ctatype-'+f+"\"><button>Deply</button><span class='padding-lr-10'>to:</span><select><option>Production</option><option>Staging</option><option>Pre staging</option></select></div>";break;default:k=""}var l=angular.element('<div class="build-result '+i+'"></div>');l.append('<div class="result-label">Result : </div>'),l.append('<div class="result-title">'+h+"</div>"),l.append('<div class="result-status">'+j+"</div>"),l.append(k),b.append(l)};return c},a}),angular.module("angularApp").factory("GridDataService",["$http","$q",function(a,b){function c(a){var b;return l.ownersInfo&&(b=l.ownersInfo[a])&&b.name}function d(a){var b;return l.stateInfo&&(b=l.stateInfo[a])&&b.title}function e(a){var b;return l.stateInfo&&(b=l.stateInfo[a])}function f(a,b){var c={},d=a.details_data[b];switch(d.status){case"pending":c["class"]="pending";break;case"running":c["class"]="running",c.progress=d.progress;break;case"failed":case"rejected":c["class"]="failed";break;case"completed":case"accepted":c["class"]="succeed"}return c}var g="data/grid_data.json",h="data/state_info.json",i="data/owner_info.json",j=function(){return a.get(i)},k=function(){return a.get(h)},l={},m=function(){return a.get(g)},n=function(a){for(var b=a.data,g=0;g<b.length;g++)b[g].metrics=f(b[g],"metrics"),b[g].build=f(b[g],"build"),b[g].ft=f(b[g],"functional_test"),b[g].ut=f(b[g],"unit_test"),b[g].ownerName=c(b[g].req_by),b[g].stateName=d(b[g].state_id),b[g].stateInfo=e(b[g].state_id);return a},o=function(a){var b=a[1],c=a[2];return l.ownersInfo=c.data,l.stateInfo=b.data,n(a[0])},p=function(){return b.all([m(),k(),j()]).then(o,function(){console.log("error while fetching data")})};return{getData:p}}]),angular.module("angularApp").controller("PieChartCtrl",["$scope",function(a){function b(a,b,c){var d=a.details_data[b].succeed,e=a.details_data[b].total-d;c.options={chart:{type:"pieChart",height:170,width:150,x:function(a){return a.key},y:function(a){return a.y},showLabels:!0,showLegend:!1,duration:500,labelSunbeamLayout:!1,color:["#EB7D3B","#72AC4D"],startAngle:function(a){return a.startAngle+Math.PI/4},endAngle:function(a){return a.endAngle+Math.PI/4}}},c.data=[{key:e,y:e},{key:d,y:d}]}a.init=function(c,d){b(c,d,a)}}]),angular.module("angularApp").controller("DetailViewCtrl",["$scope","$uibModalInstance","data",function(a,b,c){a.data=c,a.ok=function(){b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")}}]);var metricsCellTmpl='<div class="ui-grid-cell-contents"><div class="status-block {{row.entity.metrics.class}}"><div class="progress-bar" style="width: {{row.entity.metrics.progress}}%"></div></div></div>',buildCellTmpl='<div class="ui-grid-cell-contents"><div class="status-block {{row.entity.build.class}}"><div class="progress-bar" style="width: {{row.entity.build.progress}}%"></div></div></div>',utCellTmpl='<div class="ui-grid-cell-contents"><div class="status-block {{row.entity.ut.class}}"><div class="progress-bar" style="width: {{row.entity.ut.progress}}%"></div></div></div>',ftCellTmpl='<div class="ui-grid-cell-contents"><div class="status-block {{row.entity.ft.class}}"><div class="progress-bar" style="width: {{row.entity.ft.progress}}%"></div></div></div>',changeListCellTmpl='<div class="ui-grid-cell-contents"><div class="build-type-icon {{row.entity.req_type}}"></div><span class="build-type-label">{{row.entity.req_name}}</span>';angular.module("angularApp").controller("GridCtrl",["$scope","$http","$log","$templateCache","GridDataService","uiGridConstants","$uibModal",function(a,b,c,d,e,f,g){d.put("ui-grid/expandableRow",'<div ui-grid-expandable-row ng-if="expandableRow.shouldRenderExpand()" class="expandableRow" ng-class="[row.entity.stateInfo.type]" style="float:left; margin-top: 0px; margin-bottom: 1px" ng-style="{width: (grid.renderContainers.body.getCanvasWidth()) + \'px\', height: row.expandedRowHeight + \'px\'}"></div>'),d.put("ui-grid/uiGridViewport",'<div role="rowgroup" class="ui-grid-viewport" ng-style="colContainer.getViewportStyle()"><!-- tbody --><div class="ui-grid-canvas"><div ng-repeat="(rowRenderIndex, row) in rowContainer.renderedRows track by $index" class="ui-grid-row" ng-class="{\'row-expanded\': row.isExpanded}" ng-style="Viewport.rowStyle(rowRenderIndex)"><div role="row" ui-grid-row="row" row-render-index="rowRenderIndex"></div></div></div></div>'),a.gridOptions={enableSorting:!1,enableColumnMenus:!1,expandableRowTemplate:"views/rowexpandtmpl.html",expandableRowHeight:210,selectionRowHeaderWidth:35,enableExpandableRowHeader:!1,enableMinHeightCheck:!1,enableHorizontalScrollbar:f.scrollbars.NEVER,enableVerticalScrollbar:f.scrollbars.NEVER,rowHeight:45,onRegisterApi:function(b){a.gridApi=b},appScopeProvider:{onClick:function(a,b){a.api.expandable.toggleRowExpansion(b.entity)}},rowTemplate:'<div ng-click="grid.appScope.onClick(grid, row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="[{ \'ui-grid-row-header-cell\': col.isRowHeader, \'row-expanded\': row.isExpanded }, row.entity.stateInfo.type]" ui-grid-cell ></div></div>'},a.$on("metrics_box_clicked",function(a){a.stopPropagation();var b=a.targetScope.row;g.open({animation:!0,templateUrl:"views/detailsviewmodaltmpl.html",controller:"DetailViewCtrl",resolve:{data:function(){return{box:"Metrics",row:b}}}})}),a.$on("build_box_clicked",function(a){a.stopPropagation();var b=a.targetScope.row;g.open({animation:!0,templateUrl:"views/detailsviewmodaltmpl.html",controller:"DetailViewCtrl",resolve:{data:function(){return{box:"Build",row:b}}}})}),a.$on("ut_box_clicked",function(a){a.stopPropagation();var b=a.targetScope.row;g.open({animation:!0,templateUrl:"views/detailsviewmodaltmpl.html",controller:"DetailViewCtrl",resolve:{data:function(){return{box:"Unit Test",row:b}}}})}),a.$on("ft_box_clicked",function(a){a.stopPropagation();var b=a.targetScope.row;g.open({animation:!0,templateUrl:"views/detailsviewmodaltmpl.html",controller:"DetailViewCtrl",resolve:{data:function(){return{box:"Functional Test",row:b}}}})}),a.gridOptions.columnDefs=[{name:"Changelist / Build",field:"req_name",cellTemplate:changeListCellTmpl,cellClass:"req-name-cell",width:200},{name:"Owner",field:"ownerName"},{name:"Time Started",field:"time_started",type:"date",cellClass:"time-started-cell",cellFilter:'date:"MM/dd/yyyy HH:mma"',width:200},{name:"State",field:"stateName",cellClass:"state-cell"},{name:"Metrics",field:"metrics",width:100,cellTemplate:metricsCellTmpl},{name:"Build",field:"build",width:100,cellTemplate:buildCellTmpl},{name:"Unit Test",field:"ut",width:100,cellTemplate:utCellTmpl},{name:"Functional Test",field:"ft",width:150,cellTemplate:ftCellTmpl}],e.getData().then(function(b){a.gridOptions.data=b.data})}]),angular.module("angularApp").run(["$templateCache",function(a){a.put("views/buildresulttmpl.html",'<div class="build-result"> <div>Result :</div> <div>{{status_label}}</div> <div>{{}} </div></div>'),a.put("views/detailsviewmodaltmpl.html",'<div class="modal-header"> <h3 class="modal-title">{{data.box}} Details</h3> </div> <div class="modal-body"> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button> </div>'),a.put("views/grid.html",'<div ng-controller="GridCtrl"> <div ui-grid="gridOptions" ui-grid-expandable ui-grid-auto-resize class="grid"></div> </div>'),a.put("views/rowexpandtmpl.html",'<div class="row-details"> <div class="detail-row-box metrics-box" ng-click="$emit(\'metrics_box_clicked\')" ng-class="[row.entity.details_data.metrics.status]"> <div class="box-label">Metrics</div> <div> <div class="metrics-arrow-wrapper test-metrics"> <div class="metrics-arrow up"> {{row.entity.details_data.metrics.test_count}} </div> <div class="metrics-arrow-label"> Test </div> </div> <div class="metrics-arrow-wrapper maintainability-metrics"> <div class="metrics-arrow" ng-class="{\'up\' : row.entity.details_data.metrics.maintainability_count >= 0, \'down\' : row.entity.details_data.metrics.maintainability_count < 0}"> {{row.entity.details_data.metrics.maintainability_count | abs}} </div> <div class="metrics-arrow-label"> Maintainability </div> </div> </div> <div> <div class="metrics-arrow-wrapper security-metrics"> <div class="metrics-arrow right"> {{row.entity.details_data.metrics.security_count}} </div> <div class="metrics-arrow-label"> Security </div> </div> <div class="metrics-arrow-wrapper workmanship-metrics"> <div class="metrics-arrow right"> {{row.entity.details_data.metrics.workmanship_count}} </div> <div class="metrics-arrow-label"> Workmanship </div> </div> </div> </div> <div class="detail-row-box build-box" ng-click="$emit(\'build_box_clicked\')" ng-class="[row.entity.details_data.build.status]"> <div class="box-label">Build</div> <div class="build-img-wrapper"> <div class="img-wrapper"> <div class="debug-img"> </div> <div class="img-label">Debug</div> </div> <div class="img-wrapper"> <div class="release-img"> </div> <div class="img-label">Release</div> </div> <div class="clearfix"></div> </div> <div class="debug-time-label">{{row.entity.details_data.build.start_time | date:\'HH:mma - MM/dd/yyyy\'}}</div> </div> <div class="detail-row-box ut-box" ng-click="$emit(\'ut_box_clicked\')" ng-class="[row.entity.details_data.unit_test.status]"> <div class="box-label">Unit Test</div> <div class="chart-mdwrapper"> <div class="pie-chart-box" ng-controller="PieChartCtrl" ng-init="init(row.entity, \'unit_test\')"> <nvd3 options="options" data="data"></nvd3> </div> <div class="test-pass-wrapper"> <div class="test-pass-percentage">{{row.entity.details_data.unit_test.test_passed}}%</div> <div class="test-pass-label">test passed</div> </div> <div class="clearfix"></div> </div> <div class="progressbar-wrapper"> <div class="progressbar"> <div class="progress-status" ng-attr-style="width: {{row.entity.details_data.unit_test.code_covered}}%"> </div> </div> <div class="progress-indicator-wrapper"> <div class="progress-indicator">{{row.entity.details_data.unit_test.code_covered}}%</div> <div class="progress-indicator-label">code covered</div> </div> </div> </div> <div class="detail-row-box ft-box" ng-click="$emit(\'ft_box_clicked\')" ng-class="[row.entity.details_data.functional_test.status]"> <div class="box-label">Functional Test</div> <div class="chart-wrapper"> <div class="pie-chart-box" ng-controller="PieChartCtrl" ng-init="init(row.entity, \'functional_test\')"> <nvd3 options="options" data="data"></nvd3> </div> <div class="test-pass-wrapper"> <div class="test-pass-percentage">{{row.entity.details_data.functional_test.test_passed}}%</div> <div class="test-pass-label">test passed</div> </div> <div class="clearfix"></div> </div> <div class="progressbar-wrapper"> <div class="progressbar"> <div class="progress-status" ng-attr-style="width:{{row.entity.details_data.functional_test.code_covered}}%"> </div> </div> <div class="progress-indicator-wrapper"> <div class="progress-indicator">{{row.entity.details_data.functional_test.code_covered}}%</div> <div class="progress-indicator-label">code covered</div> </div> </div> </div> <div class="detail-result-section"> <build-result-section data="{{row.entity}}"></build-result-section> </div> <div class="clearfix"></div> </div>')}]);